<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F2F Automation System | Pro Agent Console</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; letter-spacing: -0.01em; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; height: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        .glass-header { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(16px); }
        .tab-content { display: none; opacity: 0; transform: translateY(10px); transition: all 0.3s ease-out; }
        .tab-content.active { display: block; opacity: 1; transform: translateY(0); }
        .modal { display: none; opacity: 0; transition: opacity 0.2s ease-out; }
        .modal.active { display: flex; opacity: 1; }
        .status-badge { font-size: 9px; font-weight: 800; padding: 4px 10px; border-radius: 8px; text-transform: uppercase; letter-spacing: 0.05em; }
        input:focus, select:focus, textarea:focus { border-color: #4f46e5; ring: 4px; ring-color: rgba(79, 70, 229, 0.1); }
        
        /* √âtat actif pour les boutons de tags */
        .tag-btn-active { transform: scale(0.98); box-shadow: inset 0 2px 4px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 overflow-hidden">

    <!-- SYST√àME DE TOAST -->
    <div id="toast" class="fixed top-6 left-1/2 -translate-x-1/2 z-[150] px-6 py-3 rounded-full shadow-2xl bg-[#0f172a] text-white flex items-center gap-3 opacity-0 pointer-events-none transition-all duration-300">
        <i data-lucide="bell-ring" class="w-4 h-4 text-indigo-400"></i>
        <p id="toast-msg" class="text-[10px] font-black uppercase tracking-widest"></p>
    </div>

    <div class="flex h-screen overflow-hidden">
        
        <!-- BARRE LAT√âRALE -->
        <nav class="w-16 lg:w-64 bg-slate-950 text-white flex flex-col shrink-0 border-r border-white/5 shadow-2xl z-50 transition-all">
            <div class="p-6 border-b border-white/5 flex items-center gap-4 justify-center lg:justify-start">
                <div class="w-10 h-10 bg-indigo-600 rounded-2xl flex items-center justify-center font-black text-white text-xs shadow-lg shadow-indigo-500/40 shrink-0">F2F</div>
                <div class="hidden lg:block">
                    <h1 class="font-black text-xs tracking-widest text-white leading-none uppercase">AGENT CONSOLE</h1>
                    <p class="text-[8px] font-bold text-indigo-400 mt-1 uppercase tracking-widest opacity-60">Logistique Premium</p>
                </div>
            </div>
            
            <div class="flex-1 py-8 px-3 space-y-2 overflow-y-auto scrollbar-hide">
                <button onclick="switchTab('dashboard')" id="nav-dashboard" class="nav-btn w-full flex items-center gap-4 px-4 py-3 rounded-xl transition-all duration-200 group">
                    <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                    <span class="hidden lg:block text-[10px] font-bold tracking-[0.15em] uppercase">Dashboard</span>
                </button>
                <button onclick="switchTab('dossiers')" id="nav-dossiers" class="nav-btn w-full flex items-center gap-4 px-4 py-3 rounded-xl transition-all duration-200 group text-slate-400 hover:bg-white/5 hover:text-white">
                    <i data-lucide="package" class="w-5 h-5"></i>
                    <span class="hidden lg:block text-[10px] font-bold tracking-[0.15em] uppercase">Dossiers</span>
                </button>
                <button onclick="switchTab('clients')" id="nav-clients" class="nav-btn w-full flex items-center gap-4 px-4 py-3 rounded-xl transition-all duration-200 group text-slate-400 hover:bg-white/5 hover:text-white">
                    <i data-lucide="users" class="w-5 h-5"></i>
                    <span class="hidden lg:block text-[10px] font-bold tracking-[0.15em] uppercase">Clients</span>
                </button>
                <button onclick="switchTab('analytics')" id="nav-analytics" class="nav-btn w-full flex items-center gap-4 px-4 py-3 rounded-xl transition-all duration-200 group text-slate-400 hover:bg-white/5 hover:text-white">
                    <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
                    <span class="hidden lg:block text-[10px] font-bold tracking-[0.15em] uppercase">Analyses</span>
                </button>
                <button onclick="switchTab('settings')" id="nav-settings" class="nav-btn w-full flex items-center gap-4 px-4 py-3 rounded-xl transition-all duration-200 group text-slate-400 hover:bg-white/5 hover:text-white">
                    <i data-lucide="settings" class="w-5 h-5"></i>
                    <span class="hidden lg:block text-[10px] font-bold tracking-[0.15em] uppercase">R√©glages</span>
                </button>
            </div>

            <div class="p-6 border-t border-white/5 text-center">
                <p class="text-[8px] font-black text-slate-600 uppercase tracking-widest">F2F Agent v3.7.0</p>
            </div>
        </nav>

        <!-- CONTENEUR PRINCIPAL -->
        <main class="flex-1 flex flex-col overflow-hidden relative">
            
            <!-- EN-T√äTE -->
            <header class="h-16 glass-header border-b border-slate-200 px-8 flex items-center justify-between shrink-0 z-40">
                <div class="flex items-center gap-4">
                    <div class="flex flex-col">
                        <span id="header-label" class="text-[9px] font-black text-slate-400 tracking-[0.3em] uppercase mb-0.5">DASHBOARD</span>
                        <div class="flex items-center gap-2">
                            <span class="text-xs font-extrabold text-slate-900 tracking-tight">Console de Gestion</span>
                            <div class="w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-sm animate-pulse"></div>
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-6">
                    <div class="hidden md:flex items-center gap-2">
                        <div class="px-3 py-1.5 bg-indigo-50 text-indigo-700 rounded-lg border border-indigo-100 flex items-center gap-2 text-[10px] font-bold">
                            <i data-lucide="refresh-cw" class="w-3 h-3"></i> 1‚Ç¨ = <span id="rate-display">7.85</span>¬•
                        </div>
                    </div>
                    <div class="w-10 h-10 rounded-2xl bg-indigo-600 text-white flex items-center justify-center font-black text-[11px] shadow-lg shadow-indigo-200">AD</div>
                </div>
            </header>

            <!-- CONTENU -->
            <div id="main-content" class="flex-1 overflow-y-auto p-8 pb-40 custom-scrollbar">
                
                <!-- DASHBOARD -->
                <section id="tab-dashboard" class="tab-content active space-y-6">
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4" id="stats-grid"></div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 space-y-6">
                            <div class="bg-white rounded-[2rem] shadow-sm border border-slate-100 flex flex-col overflow-hidden">
                                <div class="px-8 py-5 border-b border-slate-50 flex justify-between items-center bg-slate-50/20">
                                    <h3 class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-400 flex items-center gap-3">
                                        <i data-lucide="history" class="w-4 h-4 text-indigo-600"></i> Dossiers prioritaires
                                    </h3>
                                    <button onclick="switchTab('dossiers')" class="text-[9px] font-black uppercase text-indigo-600 hover:underline">Voir tout</button>
                                </div>
                                <div id="recent-orders" class="divide-y divide-slate-50"></div>
                            </div>
                        </div>
                        <div class="space-y-6 text-white">
                            <div class="bg-[#0f172a] rounded-[2.5rem] p-8 shadow-2xl relative overflow-hidden flex flex-col justify-between h-full min-h-[350px]">
                                <div class="absolute top-0 right-0 w-64 h-64 bg-indigo-500/20 rounded-full blur-[100px] -mr-16 -mt-16 pointer-events-none"></div>
                                <div class="relative z-10">
                                    <h3 class="text-[10px] font-black uppercase tracking-[0.3em] text-indigo-300 mb-8 flex items-center gap-3">
                                        <i data-lucide="zap" class="w-4 h-4 text-amber-400"></i> Actions Rapides
                                    </h3>
                                    <div class="space-y-4">
                                        <button onclick="openOrderModal()" class="w-full flex justify-between items-center p-5 bg-white/5 rounded-2xl border border-white/5 hover:bg-white/10 transition-all group">
                                            <div class="text-left text-white">
                                                <p class="text-[10px] font-black uppercase tracking-widest">Nouveau Dossier</p>
                                                <p class="text-[8px] font-bold text-slate-400 uppercase mt-1">Logistique Entrante</p>
                                            </div>
                                            <i data-lucide="plus" class="w-5 h-5 text-indigo-400 group-hover:scale-110 transition-transform"></i>
                                        </button>
                                        <button onclick="openClientModal()" class="w-full flex justify-between items-center p-5 bg-white/5 rounded-2xl border border-white/5 hover:bg-white/10 transition-all group">
                                            <div class="text-left text-white">
                                                <p class="text-[10px] font-black uppercase tracking-widest">Ajouter Client</p>
                                                <p class="text-[8px] font-bold text-slate-400 uppercase mt-1">Nouveau Profil</p>
                                            </div>
                                            <i data-lucide="user-plus" class="w-5 h-5 text-emerald-400 group-hover:scale-110 transition-transform"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- DOSSIERS -->
                <section id="tab-dossiers" class="tab-content space-y-6">
                    <div class="bg-white p-6 rounded-[2rem] border border-slate-200 shadow-sm flex flex-col md:flex-row items-center justify-between gap-4">
                        <div class="relative group flex-1 max-w-md">
                            <i data-lucide="search" class="absolute left-5 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"></i>
                            <input type="text" id="order-search" oninput="renderDossiers()" placeholder="RECHERCHER R√âF OU CLIENT..." class="w-full pl-14 pr-6 py-4 bg-slate-50 border border-slate-200 rounded-2xl text-[10px] font-black uppercase tracking-widest focus:ring-4 focus:ring-indigo-500/10 outline-none transition-all">
                        </div>
                        <button onclick="openOrderModal()" class="bg-indigo-600 text-white px-8 py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest hover:bg-indigo-700 shadow-xl shadow-indigo-200 flex items-center gap-2">
                            <i data-lucide="plus" class="w-4 h-4"></i> Cr√©er Dossier
                        </button>
                    </div>
                    <div class="bg-white rounded-[2.5rem] shadow-sm border border-slate-200 overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="bg-slate-50/50 border-b border-slate-200">
                                    <tr class="text-[10px] font-black text-slate-400 uppercase tracking-widest">
                                        <th class="px-8 py-5 text-center">R√©f</th>
                                        <th class="px-6 py-5">Client</th>
                                        <th class="px-6 py-5 text-center">Statut</th>
                                        <th class="px-6 py-5 text-center">Poids</th>
                                        <th class="px-6 py-5 text-center bg-indigo-50/20">Valeur</th>
                                        <th class="px-8 py-5 text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="orders-list" class="divide-y divide-slate-100"></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- CLIENTS -->
                <section id="tab-clients" class="tab-content space-y-6">
                    <div id="clients-list-view" class="space-y-8">
                        <!-- BARRE D'ACTIONS CLIENTS -->
                        <div class="bg-white p-6 rounded-[2rem] border border-slate-100 shadow-sm flex flex-col md:flex-row items-center justify-between gap-4">
                            <div class="flex flex-col">
                                <h2 class="text-xs font-black uppercase tracking-widest text-slate-800">R√©pertoire Clients</h2>
                                <p class="text-[9px] font-bold text-slate-400 uppercase">Gestion et base de donn√©es</p>
                            </div>
                            <button onclick="openClientModal()" class="bg-slate-900 text-white px-8 py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest hover:bg-indigo-600 transition-all flex items-center gap-2">
                                <i data-lucide="user-plus" class="w-4 h-4"></i> Cr√©er un nouveau Client
                            </button>
                        </div>
                        <div id="clients-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
                    </div>
                    <div id="client-detail-view" class="hidden space-y-8"></div>
                </section>

                <!-- ANALYSES -->
                <section id="tab-analytics" class="tab-content space-y-8">
                    <div id="analytics-cards" class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12"></div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 bg-white p-12 rounded-[3rem] border border-slate-200 shadow-xl">
                        <div class="space-y-6">
                            <h3 class="text-[11px] font-black uppercase text-slate-400 flex items-center gap-3"><i data-lucide="star" class="w-4 h-4 text-amber-500"></i> Top Clients (Profit)</h3>
                            <div id="top-clients-list" class="space-y-3"></div>
                        </div>
                        <div class="space-y-6">
                            <h3 class="text-[11px] font-black uppercase text-slate-400 flex items-center gap-3"><i data-lucide="map-pin" class="w-4 h-4 text-indigo-600"></i> Zones d'Activit√©</h3>
                            <div id="region-stats-list" class="grid grid-cols-1 gap-3"></div>
                        </div>
                    </div>
                </section>

                <!-- R√âGLAGES -->
                <section id="tab-settings" class="tab-content space-y-8 max-w-5xl mx-auto">
                    <div class="bg-white p-12 rounded-[3rem] border border-slate-200 shadow-lg grid grid-cols-1 md:grid-cols-2 gap-16">
                        <div class="space-y-8">
                            <h3 class="text-[11px] font-black text-indigo-600 uppercase border-l-4 border-indigo-500 pl-5">Param√®tres Syst√®me</h3>
                            <div class="bg-slate-50 p-6 rounded-3xl border border-slate-100">
                                <label class="block text-[10px] font-black text-slate-400 uppercase mb-4">Taux (1‚Ç¨ = X ¬•)</label>
                                <div class="flex gap-4">
                                    <input type="number" step="0.01" value="7.85" id="setting-rate" class="w-full bg-white border border-slate-200 rounded-2xl px-6 py-4 text-xl font-black outline-none shadow-sm">
                                    <button onclick="updateRate()" class="bg-indigo-600 text-white px-8 rounded-2xl font-black uppercase text-[10px]">Update</button>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-8">
                            <h3 class="text-[11px] font-black text-[#5865F2] uppercase border-l-4 border-[#5865F2] pl-5">Discord Automation</h3>
                            <div class="p-8 bg-[#5865F2]/5 border-2 border-[#5865F2]/10 rounded-[2.5rem] space-y-6">
                                <input type="text" id="setting-webhook" placeholder="Webhook URL Global..." class="w-full bg-white border border-[#5865F2]/20 rounded-2xl px-5 py-4 text-[10px] font-bold text-slate-700 outline-none">
                                <input type="text" id="setting-ping" value="@here" class="w-full bg-white border border-[#5865F2]/20 rounded-2xl px-5 py-4 text-[10px] font-bold text-slate-700 outline-none">
                                <button onclick="testDiscord()" id="btn-test-discord" class="w-full py-5 bg-[#5865F2] text-white rounded-2xl text-[10px] font-black uppercase flex items-center justify-center gap-3">
                                    <i data-lucide="send" class="w-4 h-4"></i> Tester
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- MODALE DOSSIER -->
    <div id="modal-order" class="modal fixed inset-0 z-[100] items-center justify-center bg-slate-900/60 backdrop-blur-md p-4">
        <div class="bg-white rounded-[2.5rem] shadow-2xl w-full max-w-5xl overflow-hidden flex flex-col max-h-[92vh]">
            <div class="flex items-center justify-between px-10 py-6 border-b border-slate-50">
                <h2 class="text-xs font-black tracking-widest uppercase text-slate-800" id="order-modal-title">Nouveau Dossier</h2>
                <button onclick="closeModal('modal-order')" class="p-3 text-slate-400 hover:bg-slate-50 rounded-full transition-all"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>
            <div class="p-10 overflow-y-auto custom-scrollbar bg-slate-50/20">
                <form id="form-order" onsubmit="saveOrder(event)" class="space-y-8">
                    <input type="hidden" id="edit-order-id">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div><label class="block text-[10px] font-black text-slate-500 mb-2 uppercase">R√©f√©rence</label><input required id="order-ref" class="w-full bg-white border border-slate-200 rounded-2xl p-4 text-xs font-black outline-none shadow-sm"></div>
                        <div><label class="block text-[10px] font-black text-slate-500 mb-2 uppercase">Client</label><select id="order-client" class="w-full bg-white border border-slate-200 rounded-2xl p-4 text-xs font-black outline-none cursor-pointer shadow-sm" required></select></div>
                        <div><label class="block text-[10px] font-black text-slate-500 mb-2 uppercase">Statut</label><select id="order-status" class="w-full bg-slate-950 text-white rounded-2xl p-4 text-[10px] font-black outline-none shadow-lg"></select></div>
                    </div>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center"><h3 class="text-[10px] font-black uppercase text-slate-400">Articles</h3><button type="button" onclick="addItemRow()" class="px-5 py-2 bg-indigo-600 text-white rounded-xl text-[9px] font-black uppercase tracking-widest">+ Ajouter</button></div>
                        <div id="items-container" class="space-y-4"></div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 text-slate-900">
                        <div class="bg-white p-8 rounded-[2rem] border border-slate-200 shadow-sm space-y-6">
                            <h4 class="text-[10px] font-black uppercase text-indigo-600">Exp√©dition</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <input type="number" step="0.01" id="order-weight" placeholder="Poids KG" class="w-full bg-slate-50 border border-slate-100 rounded-xl p-4 text-xs font-black outline-none">
                                <input type="number" step="0.01" id="order-ship" placeholder="Port ‚Ç¨" class="w-full bg-rose-50 border border-rose-100 rounded-xl p-4 text-xs font-black text-rose-700 outline-none">
                            </div>
                        </div>
                        <textarea id="order-notes" placeholder="Notes Internes..." class="w-full bg-white border border-slate-100 rounded-2xl p-5 text-[11px] font-bold outline-none resize-none"></textarea>
                    </div>
                    <div class="flex justify-between items-center bg-slate-950 p-8 rounded-[2.5rem] text-white">
                        <div class="flex gap-10">
                            <div><span class="text-[8px] text-slate-500 uppercase">Valeur EUR</span><p class="text-xl font-black" id="modal-total-eur">0.00 ‚Ç¨</p></div>
                            <div><span class="text-[8px] text-slate-500 uppercase">Achat RMB</span><p class="text-xl font-black text-indigo-400" id="modal-total-rmb">0 ¬•</p></div>
                        </div>
                        <button type="submit" class="px-12 py-5 bg-indigo-600 rounded-2xl text-[10px] font-black uppercase tracking-[0.3em] shadow-xl hover:bg-indigo-700 flex items-center gap-3"><i data-lucide="save" class="w-4 h-4"></i> Enregistrer & Notifier</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- MODALE CLIENT -->
    <div id="modal-client" class="modal fixed inset-0 z-[100] items-center justify-center bg-slate-900/60 backdrop-blur-md p-4">
        <div class="bg-white rounded-[3rem] shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col">
            <div class="flex items-center justify-between px-10 py-7 border-b border-slate-50">
                <h2 class="text-xs font-black tracking-widest uppercase text-slate-900" id="client-modal-title">Nouveau Client</h2>
                <button onclick="closeModal('modal-client')" class="p-2 text-slate-400 hover:bg-slate-50 rounded-full transition-all"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>
            <div class="p-10">
                <form id="form-client" onsubmit="saveClient(event)" class="space-y-6">
                    <input type="hidden" id="edit-client-id">
                    <div class="grid grid-cols-2 gap-4">
                        <input required id="client-discord" placeholder="Discord ID" class="w-full bg-slate-50 border border-slate-100 rounded-2xl p-4 text-xs font-black outline-none uppercase">
                        <input required id="client-name" placeholder="Nom R√©el" class="w-full bg-slate-50 border border-slate-100 rounded-2xl p-4 text-xs font-black outline-none uppercase">
                    </div>
                    <div class="grid grid-cols-2 gap-4 text-slate-900">
                        <input type="email" id="client-email" placeholder="E-mail" class="w-full bg-slate-50 border border-slate-100 rounded-2xl p-4 text-xs font-black outline-none">
                        <input id="client-webhook" placeholder="Webhook Client (Priv√©)" class="w-full bg-slate-50 border border-slate-100 rounded-2xl p-4 text-[10px] font-bold outline-none">
                    </div>
                    <div class="bg-slate-50 p-6 rounded-3xl border border-slate-100 space-y-4 text-slate-900">
                        <h3 class="text-[9px] font-black text-indigo-600 uppercase">Adresse Postale</h3>
                        <input id="client-address" placeholder="Rue / Avenue" class="w-full bg-white border border-slate-200 rounded-xl p-3 text-[10px] font-bold uppercase shadow-sm outline-none">
                        <div class="grid grid-cols-2 gap-4">
                            <input id="client-zip" placeholder="CP" class="w-full bg-white border border-slate-200 rounded-xl p-3 text-[10px] font-bold shadow-sm outline-none">
                            <input id="client-city" placeholder="Ville" class="w-full bg-white border border-slate-200 rounded-xl p-3 text-[10px] font-bold uppercase shadow-sm outline-none">
                        </div>
                    </div>
                    <div class="flex items-center justify-between pt-4">
                         <div class="flex gap-2">
                            <button type="button" onclick="setClientTag('STANDARD')" id="tag-standard" class="tag-btn px-4 py-3 rounded-xl text-[8px] font-black uppercase border border-slate-200 bg-white transition-all">Standard</button>
                            <button type="button" onclick="setClientTag('VIP')" id="tag-vip" class="tag-btn px-4 py-3 rounded-xl text-[8px] font-black uppercase border border-slate-200 bg-white text-amber-500 transition-all">VIP ‚òÖ</button>
                            <button type="button" onclick="setClientTag('WARNING')" id="tag-warning" class="tag-btn px-4 py-3 rounded-xl text-[8px] font-black uppercase border border-slate-200 bg-white text-rose-500 transition-all">Warning</button>
                            <input type="hidden" id="client-tag" value="STANDARD">
                         </div>
                         <button type="submit" class="px-8 py-5 bg-slate-950 text-white rounded-2xl text-[9px] font-black uppercase shadow-xl hover:bg-indigo-600 transition-all">Sauvegarder</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURATION & √âTAT ---
        const STATUS_OPTIONS = ["DEMANDE RE√áUE", "ACHAT EN COURS", "ARRIV√â ENTREP√îT", "QC EN COURS", "QC VALID√â", "FACTURATION", "PAIEMENT RE√áU", "EMBALLAGE", "EXP√âDI√â", "EN TRANSIT", "DOUANE", "LIVRAISON EN COURS", "LIVR√â", "INCIDENT"];
        const QUICK_REPLIES = ["üì¶ Articles arriv√©s √† l'entrep√¥t !", "üí∞ Facture disponible.", "üì∏ Photos QC ajout√©es.", "‚ö†Ô∏è Pr√©cisions requises."];

        let state = { exchangeRate: 7.85, discordWebhook: "", discordPing: "@here", clients: [], dossiers: [] };

        const saveToStorage = () => localStorage.setItem('f2f_pro_state_v3', JSON.stringify(state));
        const loadState = () => {
            const saved = localStorage.getItem('f2f_pro_state_v3');
            if (saved) state = JSON.parse(saved);
        };

        // --- DISCORD INTEGRATION ---
        const sendToDiscord = async (webhookUrl, payload) => {
            const url = webhookUrl || state.discordWebhook;
            if (!url || !url.startsWith('http')) return;
            try {
                await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            } catch (e) { console.error("Discord Error", e); }
        };

        const notifyOrderAction = (order, isUpdate = false) => {
            const client = state.clients.find(c => c.id === order.clientId);
            const totalEur = order.items.reduce((acc, i) => acc + i.eur, 0);
            const itemsList = order.items.map(i => `‚Ä¢ ${i.name}`).join('\n') || "Aucun article";
            const color = isUpdate ? 3447003 : 5763719; 
            const title = isUpdate ? "üîÑ Mise √† jour Dossier" : "üÜï Nouveau Dossier F2F";

            const payload = {
                content: state.discordPing,
                embeds: [{
                    title: title,
                    color: color,
                    fields: [
                        { name: "üë§ Client", value: `**${client?.discord || "Inconnu"}**`, inline: true },
                        { name: "üì¶ R√©f", value: `\`${order.ref}\``, inline: true },
                        { name: "üè∑Ô∏è Statut", value: `**${order.status}**`, inline: true },
                        { name: "‚öñÔ∏è Poids", value: `${order.weight} KG`, inline: true },
                        { name: "üí∂ Valeur", value: `${totalEur.toFixed(2)} ‚Ç¨`, inline: true },
                        { name: "üóíÔ∏è Inventaire", value: itemsList }
                    ],
                    footer: { text: "F2F System ‚Ä¢ " + new Date().toLocaleString() }
                }]
            };
            sendToDiscord(client?.webhook, payload);
        };

        const sendManualMessage = async (clientId, message) => {
            const client = state.clients.find(c => c.id === clientId);
            const payload = {
                content: state.discordPing,
                embeds: [{
                    title: "üí¨ Notification Freight2France",
                    description: `> ${message}`,
                    color: 3447003,
                    footer: { text: "Support F2F" },
                    timestamp: new Date().toISOString()
                }]
            };
            await sendToDiscord(client?.webhook, payload);
            showToast("Notification Discord envoy√©e !");
        };

        // --- NAVIGATION ---
        const switchTab = (tabId) => {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-white/10', 'text-indigo-400');
                btn.classList.add('text-slate-400');
            });
            document.getElementById('nav-' + tabId).classList.add('bg-white/10', 'text-indigo-400');
            document.getElementById('header-label').innerText = tabId.toUpperCase();
            
            if (tabId === 'dashboard') renderDashboard();
            if (tabId === 'dossiers') renderDossiers();
            if (tabId === 'clients') {
                hideClientDetail(); 
                renderClients();
            }
            if (tabId === 'analytics') renderAnalytics();
            lucide.createIcons();
        };

        // --- GESTION DOSSIERS ---
        const openOrderModal = (id = null) => {
            const form = document.getElementById('form-order');
            form.reset();
            document.getElementById('items-container').innerHTML = '';
            
            const clientSelect = document.getElementById('order-client');
            clientSelect.innerHTML = state.clients.map(c => `<option value="${c.id}">${c.discord}</option>`).join('');
            
            const statusSelect = document.getElementById('order-status');
            statusSelect.innerHTML = STATUS_OPTIONS.map(s => `<option value="${s}">${s}</option>`).join('');

            if (id) {
                const o = state.dossiers.find(d => d.id === id);
                document.getElementById('edit-order-id').value = o.id;
                document.getElementById('order-ref').value = o.ref;
                document.getElementById('order-client').value = o.clientId;
                document.getElementById('order-status').value = o.status;
                document.getElementById('order-weight').value = o.weight;
                document.getElementById('order-ship').value = o.shippingCost;
                document.getElementById('order-notes').value = o.notes || "";
                o.items.forEach(i => addItemRow(i.name, i.rmb, i.eur));
                document.getElementById('order-modal-title').innerText = "Modifier Dossier";
            } else {
                document.getElementById('edit-order-id').value = "";
                document.getElementById('order-modal-title').innerText = "Nouveau Dossier";
                addItemRow();
            }
            calculateModalTotals();
            openModal('modal-order');
        };

        const addItemRow = (n = "", r = "", e = "") => {
            const container = document.getElementById('items-container');
            const div = document.createElement('div');
            div.className = "flex gap-3 bg-white p-3 rounded-xl border border-slate-100 items-center animate-in slide-in-from-left-2 duration-200 text-slate-900";
            div.innerHTML = `
                <input placeholder="Article" class="flex-1 bg-transparent text-[10px] font-bold uppercase outline-none" value="${n}" oninput="calculateModalTotals()">
                <input type="number" placeholder="¬•" class="w-16 bg-slate-50 p-2 rounded-lg text-center font-black text-[10px]" value="${r}" oninput="calculateModalTotals()">
                <input type="number" placeholder="‚Ç¨" class="w-16 bg-indigo-50 p-2 rounded-lg text-center font-black text-[10px]" value="${e}" oninput="calculateModalTotals()">
                <button type="button" onclick="this.parentElement.remove(); calculateModalTotals();" class="text-rose-400 hover:text-rose-600"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
            `;
            container.appendChild(div);
            lucide.createIcons();
        };

        const calculateModalTotals = () => {
            let eur = 0, rmb = 0;
            document.querySelectorAll('#items-container > div').forEach(row => {
                const inputs = row.querySelectorAll('input');
                rmb += parseFloat(inputs[1].value) || 0;
                eur += parseFloat(inputs[2].value) || 0;
            });
            document.getElementById('modal-total-eur').innerText = eur.toFixed(2) + ' ‚Ç¨';
            document.getElementById('modal-total-rmb').innerText = rmb.toFixed(0) + ' ¬•';
        };

        const saveOrder = (e) => {
            e.preventDefault();
            const id = document.getElementById('edit-order-id').value;
            const items = Array.from(document.querySelectorAll('#items-container > div')).map(row => {
                const inputs = row.querySelectorAll('input');
                return { name: inputs[0].value, rmb: parseFloat(inputs[1].value) || 0, eur: parseFloat(inputs[2].value) || 0 };
            });

            const order = {
                id: id || 'o' + Date.now(),
                ref: document.getElementById('order-ref').value,
                clientId: document.getElementById('order-client').value,
                status: document.getElementById('order-status').value,
                weight: parseFloat(document.getElementById('order-weight').value) || 0,
                shippingCost: parseFloat(document.getElementById('order-ship').value) || 0,
                items: items,
                notes: document.getElementById('order-notes').value,
                createdAt: id ? (state.dossiers.find(d => d.id === id).createdAt) : new Date().toISOString()
            };

            if (id) {
                const idx = state.dossiers.findIndex(d => d.id === id);
                state.dossiers[idx] = order;
                notifyOrderAction(order, true);
            } else {
                state.dossiers.unshift(order);
                notifyOrderAction(order, false);
            }

            saveToStorage();
            closeModal('modal-order');
            switchTab('dossiers');
            showToast("Dossier enregistr√© !");
        };

        // --- CLIENTS ---
        const setClientTag = (tag) => {
            document.getElementById('client-tag').value = tag;
            document.querySelectorAll('.tag-btn').forEach(btn => {
                btn.classList.remove('tag-btn-active', 'bg-slate-900', 'text-white', 'border-amber-500', 'bg-amber-50', 'border-rose-500', 'bg-rose-50');
                btn.classList.add('bg-white', 'border-slate-200');
            });
            
            const btnId = 'tag-' + tag.toLowerCase();
            const activeBtn = document.getElementById(btnId);
            activeBtn.classList.add('tag-btn-active');
            activeBtn.classList.remove('bg-white', 'border-slate-200');
            
            if(tag === 'STANDARD') activeBtn.classList.add('bg-slate-900', 'text-white');
            if(tag === 'VIP') activeBtn.classList.add('border-amber-500', 'bg-amber-50');
            if(tag === 'WARNING') activeBtn.classList.add('border-rose-500', 'bg-rose-50');
        };

        const openClientModal = (id = null) => {
            const form = document.getElementById('form-client');
            form.reset();
            if (id) {
                const c = state.clients.find(x => x.id === id);
                document.getElementById('edit-client-id').value = c.id;
                document.getElementById('client-discord').value = c.discord;
                document.getElementById('client-name').value = c.realName;
                document.getElementById('client-email').value = c.email || "";
                document.getElementById('client-webhook').value = c.webhook || "";
                document.getElementById('client-address').value = c.address || "";
                document.getElementById('client-zip').value = c.zip || "";
                document.getElementById('client-city').value = c.city || "";
                setClientTag(c.tag || 'STANDARD');
                document.getElementById('client-modal-title').innerText = "Modifier Profil Client";
            } else {
                document.getElementById('edit-client-id').value = "";
                document.getElementById('client-modal-title').innerText = "Nouveau Client";
                setClientTag('STANDARD');
            }
            openModal('modal-client');
        };

        const saveClient = (e) => {
            e.preventDefault();
            const id = document.getElementById('edit-client-id').value;
            const client = {
                id: id || 'c' + Date.now(),
                discord: document.getElementById('client-discord').value,
                realName: document.getElementById('client-name').value,
                email: document.getElementById('client-email').value,
                webhook: document.getElementById('client-webhook').value,
                address: document.getElementById('client-address').value,
                zip: document.getElementById('client-zip').value,
                city: document.getElementById('client-city').value,
                tag: document.getElementById('client-tag').value
            };

            if (id) {
                const idx = state.clients.findIndex(c => c.id === id);
                state.clients[idx] = client;
            } else {
                state.clients.push(client);
            }

            saveToStorage();
            closeModal('modal-client');
            renderClients();
            showToast("Profil client enregistr√© !");
        };

        const showClientDetail = (id) => {
            const c = state.clients.find(x => x.id === id);
            const ds = state.dossiers.filter(d => d.clientId === id);
            const view = document.getElementById('client-detail-view');
            document.getElementById('clients-list-view').classList.add('hidden');
            view.classList.remove('hidden');

            const totalKg = ds.reduce((acc, d) => acc + d.weight, 0).toFixed(1);
            const totalEur = ds.reduce((acc, d) => acc + d.items.reduce((s,i)=>s+i.eur,0), 0).toFixed(2);

            view.innerHTML = `
                <div class="flex justify-between items-center bg-white p-4 rounded-2xl border border-slate-100 shadow-sm animate-in fade-in duration-300">
                    <button onclick="hideClientDetail()" class="flex items-center gap-2 text-[10px] font-black uppercase text-slate-400 hover:text-indigo-600"><i data-lucide="arrow-left" class="w-4 h-4"></i> Liste des Clients</button>
                    <button onclick="openClientModal('${c.id}')" class="px-6 py-2 bg-slate-100 rounded-xl text-[10px] font-black uppercase hover:bg-indigo-50 hover:text-indigo-600 transition-all">√âditer Profil</button>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="bg-white p-8 rounded-[2.5rem] border border-slate-100 shadow-sm space-y-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-slate-900 text-white rounded-2xl flex items-center justify-center font-black text-2xl uppercase">${c.discord.slice(0,2)}</div>
                            <div><h2 class="text-xl font-black uppercase tracking-tight text-slate-900">${c.discord}</h2><p class="text-[9px] font-bold text-slate-400 uppercase tracking-widest">${c.realName}</p></div>
                        </div>
                        <div class="pt-6 border-t border-slate-50 space-y-4">
                            <div class="text-[10px] font-bold"><p class="text-slate-400 uppercase tracking-widest mb-1 text-[8px]">E-mail</p><p class="text-slate-700">${c.email || '---'}</p></div>
                            <div class="text-[10px] font-bold uppercase"><p class="text-slate-400 tracking-widest mb-1 text-[8px]">Adresse</p><p class="text-slate-700">${c.address || ''}<br>${c.zip || ''} ${c.city || ''}</p></div>
                        </div>
                        <div class="pt-6 border-t border-slate-50 space-y-4">
                            <p class="text-[9px] font-black uppercase text-indigo-600 tracking-widest flex items-center gap-2"><i data-lucide="message-square" class="w-3 h-3"></i> Notifications Directes</p>
                            <div class="flex flex-col gap-2">
                                ${QUICK_REPLIES.map(msg => `<button onclick="sendManualMessage('${c.id}', '${msg}')" class="px-4 py-3 bg-slate-50 border border-slate-100 rounded-xl text-[9px] font-bold text-slate-600 hover:bg-indigo-600 hover:text-white transition-all text-left"><span>${msg}</span></button>`).join('')}
                            </div>
                        </div>
                    </div>
                    <div class="lg:col-span-2 space-y-6">
                        <div class="grid grid-cols-3 gap-4">
                            <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm text-center"><p class="text-[9px] font-black uppercase text-slate-400 mb-1">Dossiers</p><p class="text-xl font-black text-slate-900">${ds.length}</p></div>
                            <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm text-center"><p class="text-[9px] font-black uppercase text-slate-400 mb-1">Volume</p><p class="text-xl font-black text-slate-900">${totalKg} KG</p></div>
                            <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm text-center"><p class="text-[9px] font-black uppercase text-slate-400 mb-1">Total</p><p class="text-xl font-black text-indigo-600">${totalEur} ‚Ç¨</p></div>
                        </div>
                        <div class="bg-white rounded-[2.5rem] border border-slate-100 shadow-sm overflow-hidden">
                            <table class="w-full text-left"><thead class="bg-slate-50 border-b border-slate-100 font-black text-[9px] uppercase text-slate-400"><tr><th class="px-6 py-4">Dossier</th><th class="px-4 py-4">Statut</th><th class="px-4 py-4 text-center">Valeur</th></tr></thead><tbody class="divide-y divide-slate-50">
                                ${ds.map(d => `<tr onclick="openOrderModal('${d.id}')" class="hover:bg-slate-50 cursor-pointer group transition-all"><td class="px-6 py-4 text-xs font-black uppercase text-slate-900">${d.ref}</td><td class="px-4 py-4"><span class="status-badge bg-white border border-slate-100 text-slate-400 group-hover:text-indigo-500">${d.status}</span></td><td class="px-4 py-4 text-center text-xs font-black text-slate-700">${d.items.reduce((acc,i)=>acc+i.eur,0).toFixed(0)}‚Ç¨</td></tr>`).join('') || '<tr><td colspan="3" class="p-10 text-center text-[10px] font-bold text-slate-300">HISTORIQUE VIDE</td></tr>'}
                            </tbody></table>
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
        };

        const hideClientDetail = () => {
            document.getElementById('clients-list-view').classList.remove('hidden');
            document.getElementById('client-detail-view').classList.add('hidden');
        };

        // --- ANALYSES ---
        const renderAnalytics = () => {
            const cards = document.getElementById('analytics-cards');
            const totalSale = state.dossiers.reduce((acc, d) => acc + d.items.reduce((s, i) => s + i.eur, 0), 0);
            const totalWeight = state.dossiers.reduce((acc, d) => acc + d.weight, 0);
            const totalProfit = state.dossiers.reduce((acc, d) => {
                const s = d.items.reduce((sum, i) => sum + i.eur, 0);
                const p = d.items.reduce((sum, i) => sum + (i.rmb / state.exchangeRate), 0);
                return acc + (s - p);
            }, 0);

            cards.innerHTML = `
                <div class="p-8 bg-white rounded-[2.5rem] border border-slate-100 shadow-sm text-center"><p class="text-[9px] font-black uppercase text-slate-400 mb-2">Chiffre d'Affaires</p><p class="text-3xl font-black text-slate-900">${totalSale.toFixed(2)}‚Ç¨</p></div>
                <div class="p-8 bg-emerald-50 rounded-[2.5rem] border border-emerald-100 text-center"><p class="text-[9px] font-black uppercase text-emerald-600 mb-2">Marge Brute Estim√©e</p><p class="text-3xl font-black text-emerald-700">+${totalProfit.toFixed(2)}‚Ç¨</p></div>
                <div class="p-8 bg-indigo-50 rounded-[2.5rem] border border-indigo-100 text-center"><p class="text-[9px] font-black uppercase text-indigo-600 mb-2">Volume Trait√©</p><p class="text-3xl font-black text-indigo-700">${totalWeight.toFixed(1)} KG</p></div>
            `;

            const topList = state.clients.map(c => {
                const clientDs = state.dossiers.filter(d => d.clientId === c.id);
                const margin = clientDs.reduce((acc, d) => {
                    const s = d.items.reduce((sum, i) => sum + i.eur, 0);
                    const p = d.items.reduce((sum, i) => sum + (i.rmb / state.exchangeRate), 0);
                    return acc + (s - p);
                }, 0);
                return { discord: c.discord, margin: margin };
            }).sort((a,b) => b.margin - a.margin).slice(0, 5);

            document.getElementById('top-clients-list').innerHTML = topList.map((c, i) => `
                <div class="flex items-center justify-between p-4 bg-slate-50 rounded-2xl border border-slate-100 shadow-sm">
                    <div class="flex items-center gap-4"><span class="text-lg font-black text-slate-200">#${i+1}</span><span class="text-xs font-black uppercase text-slate-700">${c.discord}</span></div>
                    <span class="text-xs font-black text-emerald-600">+${c.margin.toFixed(0)}‚Ç¨</span>
                </div>
            `).join('');

            const cities = [...new Set(state.clients.map(c => c.city || "Non renseign√©e"))];
            document.getElementById('region-stats-list').innerHTML = cities.map(city => {
                const count = state.clients.filter(c => (c.city || "Non renseign√©e") === city).length;
                return `
                    <div class="flex items-center justify-between p-4 bg-slate-50 rounded-2xl border border-slate-100">
                        <span class="text-xs font-black uppercase text-slate-600">${city}</span>
                        <span class="px-3 py-1 bg-white border border-slate-100 rounded-lg text-[9px] font-black text-indigo-600">${count} PROFIL(S)</span>
                    </div>
                `;
            }).join('');
        };

        // --- DASHBOARD RENDERING ---
        const renderDashboard = () => {
            const grid = document.getElementById('stats-grid');
            const totalKg = state.dossiers.reduce((acc, d) => acc + d.weight, 0).toFixed(1);
            const totalEur = state.dossiers.reduce((acc, d) => acc + d.items.reduce((s,i)=>s+i.eur,0), 0).toFixed(0);
            const active = state.dossiers.filter(d => d.status !== 'LIVR√â').length;
            
            grid.innerHTML = `
                <div class="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm transition-all hover:shadow-md"><p class="text-[9px] font-black uppercase text-slate-400 mb-1">Dossiers Actifs</p><p class="text-2xl font-black text-slate-900">${active}</p></div>
                <div class="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm transition-all hover:shadow-md"><p class="text-[9px] font-black uppercase text-slate-400 mb-1">Masse (KG)</p><p class="text-2xl font-black text-slate-900">${totalKg}</p></div>
                <div class="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm transition-all hover:shadow-md"><p class="text-[9px] font-black uppercase text-slate-400 mb-1">Ventes Totales</p><p class="text-2xl font-black text-indigo-600">${totalEur} ‚Ç¨</p></div>
                <div class="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm transition-all hover:shadow-md"><p class="text-[9px] font-black uppercase text-slate-400 mb-1">Effectif Clients</p><p class="text-2xl font-black text-slate-900">${state.clients.length}</p></div>
            `;

            document.getElementById('recent-orders').innerHTML = state.dossiers.slice(0, 5).map(d => `
                <div class="px-8 py-5 flex justify-between items-center hover:bg-slate-50 cursor-pointer group" onclick="openOrderModal('${d.id}')">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 bg-indigo-50 text-indigo-600 rounded-xl flex items-center justify-center font-black text-[10px] uppercase group-hover:scale-105 transition-transform">${d.ref.slice(1,4)}</div>
                        <div><p class="text-xs font-black uppercase text-slate-900 group-hover:text-indigo-600">${d.ref}</p><p class="text-[9px] font-bold text-slate-400 uppercase">${state.clients.find(c => c.id === d.clientId)?.discord || '---'}</p></div>
                    </div>
                    <span class="status-badge bg-white border border-slate-100 text-slate-400">${d.status}</span>
                </div>
            `).join('') || '<div class="p-10 text-center text-[10px] font-bold text-slate-300">VIDE</div>';
        };

        const renderDossiers = () => {
            const list = document.getElementById('orders-list');
            const search = document.getElementById('order-search').value.toLowerCase();
            const filtered = state.dossiers.filter(d => {
                const client = state.clients.find(c => c.id === d.clientId)?.discord.toLowerCase() || "";
                return d.ref.toLowerCase().includes(search) || client.includes(search);
            });

            list.innerHTML = filtered.map(d => `
                <tr class="hover:bg-slate-50 cursor-pointer group transition-all" onclick="openOrderModal('${d.id}')">
                    <td class="px-8 py-5 text-center"><span class="bg-slate-900 text-white px-3 py-2 rounded-xl text-[9px] font-black uppercase group-hover:bg-indigo-600">${d.ref}</span></td>
                    <td class="px-6 py-5 font-black text-xs uppercase text-slate-900">${state.clients.find(c => c.id === d.clientId)?.discord || '---'}</td>
                    <td class="px-6 py-5 text-center"><span class="status-badge bg-white border border-slate-100 text-slate-500">${d.status}</span></td>
                    <td class="px-6 py-5 text-center text-xs font-bold text-slate-500">${d.weight} KG</td>
                    <td class="px-6 py-5 text-center bg-indigo-50/20 font-black text-indigo-700">${d.items.reduce((acc,i)=>acc+i.eur,0).toFixed(2)} ‚Ç¨</td>
                    <td class="px-8 py-5 text-right"><button onclick="event.stopPropagation(); deleteOrder('${d.id}')" class="p-2 text-slate-200 hover:text-rose-600 transition-colors"><i data-lucide="trash-2" class="w-4 h-4"></i></button></td>
                </tr>
            `).join('');
            lucide.createIcons();
        };

        const renderClients = () => {
            document.getElementById('clients-grid').innerHTML = state.clients.map(c => `
                <div onclick="showClientDetail('${c.id}')" class="bg-white p-8 rounded-[2.5rem] border border-slate-100 shadow-sm hover:shadow-2xl transition-all cursor-pointer group animate-in zoom-in-95 duration-200">
                    <div class="flex justify-between items-start mb-6">
                        <div class="w-14 h-14 bg-slate-900 text-white rounded-2xl flex items-center justify-center font-black text-xl group-hover:bg-indigo-600 transition-all uppercase">${c.discord.slice(0,2)}</div>
                        ${c.tag === 'VIP' ? '<i data-lucide="star" class="w-5 h-5 text-amber-400 fill-amber-400 drop-shadow-sm"></i>' : ''}
                    </div>
                    <h3 class="text-lg font-black uppercase tracking-tight text-slate-900 group-hover:text-indigo-600 transition-colors">${c.discord}</h3>
                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">${c.realName}</p>
                </div>
            `).join('');
            lucide.createIcons();
        };

        const deleteOrder = (id) => { if(confirm("Supprimer ce dossier ?")) { state.dossiers = state.dossiers.filter(d => d.id !== id); saveToStorage(); renderDossiers(); showToast("Dossier supprim√©"); } };

        // --- UTILS UI ---
        const openModal = (id) => { document.getElementById(id).classList.add('active'); };
        const closeModal = (id) => { document.getElementById(id).classList.remove('active'); };
        const showToast = (msg) => {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            t.style.opacity = '1'; t.style.transform = 'translate(-50%, -10px)';
            setTimeout(() => { t.style.opacity = '0'; t.style.transform = 'translate(-50%, 0)'; }, 3000);
        };

        const updateRate = () => {
            state.exchangeRate = parseFloat(document.getElementById('setting-rate').value) || 7.85;
            document.getElementById('rate-display').innerText = state.exchangeRate;
            saveToStorage(); showToast("Taux mis √† jour !");
        };

        const testDiscord = async () => {
            state.discordWebhook = document.getElementById('setting-webhook').value;
            state.discordPing = document.getElementById('setting-ping').value;
            saveToStorage();
            await sendToDiscord(null, { 
                content: `${state.discordPing} üöÄ **Syst√®me F2F Op√©rationnel**`,
                embeds: [{ title: "Canal Discord pr√™t", description: "Liaison √©tablie avec la console agent.", color: 5763719, timestamp: new Date().toISOString() }]
            });
            showToast("Test envoy√© !");
        };

        // --- INITIALISATION ---
        window.onload = () => { loadState(); switchTab('dashboard'); document.getElementById('rate-display').innerText = state.exchangeRate; };
    </script>
</body>
</html>
